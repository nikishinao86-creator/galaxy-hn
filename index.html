<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hunter Network</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Three.js (–≤–µ—Ä—Å–∏—è r128 ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –¥–ª—è CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: sans-serif;
    }
    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      pointer-events: none;
      z-index: 1;
      opacity: 0.95;
      font-size: 14px;
      text-shadow: 0 0 5px #000;
    }
  </style>
</head>
<body>
  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div id="info">üåå –ó–∞–≥—Ä—É–∑–∫–∞ –≥–∞–ª–∞–∫—Ç–∏–∫–∏...</div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = tg.initDataUnsafe.user;
    const startParam = tg.initDataUnsafe.start_param; // –Ω–∞–ø—Ä–∏–º–µ—Ä: gal_123456789

    if (startParam) {
      const refId = startParam.split('_')[1];
      console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—à—ë–ª –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –æ—Ç:', refId);
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä: fetch('/api/join', { user.id, refId })
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    document.getElementById("info").textContent = `üåå –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.first_name}!`;

    // --- Three.js —Å—Ü–µ–Ω–∞ ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x000011);
    document.body.appendChild(renderer.domElement);

    // –ó–≤—ë–∑–¥–Ω—ã–π —Ñ–æ–Ω (10 000 –∑–≤—ë–∑–¥)
    const starsGeometry = new THREE.BufferGeometry();
    const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });

    const starsVertices = [];
    for (let i = 0; i < 10000; i++) {
      const x = THREE.MathUtils.randFloatSpread(200);
      const y = THREE.MathUtils.randFloatSpread(200);
      const z = THREE.MathUtils.randFloatSpread(200);
      starsVertices.push(x, y, z);
    }

    starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
    const stars = new THREE.Points(starsGeometry, starsMaterial);
    scene.add(stars);

    // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–≤–µ–∑–¥–∞ ‚Äî —Ç—ã
    const starGeometry = new THREE.SphereGeometry(1, 64, 64);
    const starMaterial = new THREE.MeshBasicMaterial({
      color: 0xffd700,
      emissive: 0xffa500,
      emissiveIntensity: 1.5
    });
    const star = new THREE.Mesh(starGeometry, starMaterial);
    scene.add(star);

    // –ó–∞–≥—Ä—É–∑—á–∏–∫ —Ç–µ–∫—Å—Ç—É—Ä
    const textureLoader = new THREE.TextureLoader();

    // –¢–µ–∫—Å—Ç—É—Ä—ã –ø–ª–∞–Ω–µ—Ç (–∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è three.js)
    const planetTextures = [
      { name: "Earth",   color: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg",
                        bump:  "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_normal_2048.jpg" },
      { name: "Mars",    color: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mars_1k_color.jpg",
                        bump:  "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mars_1k_normal.jpg" },
      { name: "Venus",   color: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/venus_surface.jpg" },
      { name: "Jupiter", color: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/jupiter_1k.jpg" },
      { name: "Neptune", color: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/neptune_1k.jpg" }
    ];

    // –ü–ª–∞–Ω–µ—Ç—ã (—Ä–µ—Ñ–µ—Ä–∞–ª—ã 1-–≥–æ —É—Ä–æ–≤–Ω—è)
    const planetCount = 5;
    const planets = [];

    for (let i = 0; i < planetCount; i++) {
      const angle = (i / planetCount) * Math.PI * 2;
      const radius = 7;

      const texData = planetTextures[i % planetTextures.length];
      const geometry = new THREE.SphereGeometry(0.6, 64, 64);

      const material = new THREE.MeshPhongMaterial({
        map: textureLoader.load(texData.color),
        bumpMap: texData.bump ? textureLoader.load(texData.bump) : null,
        bumpScale: 0.05,
        specular: 0x333333,
        shininess: 10
      });

      const planet = new THREE.Mesh(geometry, material);
      planet.position.x = Math.cos(angle) * radius;
      planet.position.z = Math.sin(angle) * radius;
      scene.add(planet);

      // –õ—É–Ω—ã (—Ä–µ—Ñ–µ—Ä–∞–ª—ã 2-–≥–æ —É—Ä–æ–≤–Ω—è)
      const moonCount = i < 3 ? 2 : 1;
      for (let j = 0; j < moonCount; j++) {
        const moonAngle = (j / moonCount) * Math.PI * 2;
        const moonGeometry = new THREE.SphereGeometry(0.2, 32, 32);
        const moonMaterial = new THREE.MeshBasicMaterial({ color: 0xdddddd });
        const moon = new THREE.Mesh(moonGeometry, moonMaterial);

        moon.position.x = planet.position.x + Math.cos(moonAngle) * 1.2;
        moon.position.z = planet.position.z + Math.sin(moonAngle) * 1.2;
        scene.add(moon);
      }

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
      planets.push({
        mesh: planet,
        angle: angle,
        speed: 0.003 + Math.random() * 0.003
      });
    }

    // –ö–∞–º–µ—Ä–∞
    camera.position.z = 15;

    // –ê–Ω–∏–º–∞—Ü–∏—è
    function animate() {
      requestAnimationFrame(animate);

      // –í—Ä–∞—â–µ–Ω–∏–µ –∑–≤–µ–∑–¥—ã (—Ç–µ–±—è)
      star.rotation.y += 0.005;

      // –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç –ø–æ –æ—Ä–±–∏—Ç–∞–º –∏ –≤—Ä–∞—â–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ —Å–≤–æ–µ–π –æ—Å–∏
      planets.forEach(p => {
        p.angle += p.speed;
        p.mesh.position.x = Math.cos(p.angle) * 7;
        p.mesh.position.z = Math.sin(p.angle) * 7;
        p.mesh.rotation.y += 0.01;
      });

      renderer.render(scene, camera);
    }
    animate();

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
